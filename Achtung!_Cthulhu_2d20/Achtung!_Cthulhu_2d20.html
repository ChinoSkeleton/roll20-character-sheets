<input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab" value="main_char" />
<div>
  <button type="action" class="tab_button" id="act_main_char" name="act_main_char">
    Main
  </button>
  <button type="action" class="tab_button" id="act_equipment" name="act_equipment">
    Equipment/Talents
  </button>
  <button type="action" class="tab_button" id="act_spells" name="act_spells">
    Spells
  </button>
  <button type="action" class="tab_button settings_button" id="act_settings" name="act_settings">
    settings
  </button>
</div>

<div class="sheet-main_char">
  <section class="mc_header f-row f-center">
    <h1>Achtung! Cthulhu</h1>
    <span>Character Record Sheet</span>
    <span>2d20</span>
  </section>

  <section class="common f-row wrap">
    <div>
      <label>Name:</label>
      <input name="attr_character_name" type="text" style="width: 350px" />
    </div>
    <div>
      <label>Nationality:</label>
      <input name="attr_nationality" type="text" style="width: 200px" />
    </div>
    <div>
      <label>Rank:</label>
      <input name="attr_rank" type="text" style="width: 200px" />
    </div>
    <div>
      <label>Archetype:</label>
      <input name="attr_archetype" type="text" style="width: 250px" />
    </div>
    <div>
      <label>Background:</label>
      <input name="attr_background" type="text" style="width: 250px" />
    </div>
    <div>
      <label>Characteristic:</label>
      <input name="attr_characteristic" type="text" style="width: 250px" />
    </div>
    <div>
      <label>Personal Truths & Scars:</label>
      <div class="f-row nowrap truth_text">
        <textarea name="attr_truth_1"></textarea>
        <textarea name="attr_truth_2"></textarea>
        <textarea name="attr_truth_3"></textarea>
        <textarea name="attr_truth_4"></textarea>
        <textarea name="attr_truth_5"></textarea>
      </div>
    </div>
  </section>

  <section class="stress">
    <div>
      <div class="nowrap">
        <label>Stress:</label>
        <span style="
            font-weight: bold;
            font-size: 1.2em;
            margin-top: 3px;
            padding-top: 3px;
          ">Maximum:</span>
        <input type="number" name="attr_stress_max" value="0" />
      </div>
      <div style="width: fit-content">
        <input name="attr_stress_1" type="checkbox" />
        <input name="attr_stress_2" type="checkbox" />
        <input name="attr_stress_3" type="checkbox" />
        <input name="attr_stress_4" type="checkbox" />
        <input name="attr_stress_5" type="checkbox" />
        <input name="attr_stress_6" type="checkbox" />
        <input name="attr_stress_7" type="checkbox" />
        <input name="attr_stress_8" type="checkbox" />
        <input name="attr_stress_9" type="checkbox" />
        <input name="attr_stress_10" type="checkbox" />
      </div>
      <div style="width: fit-content">
        <input name="attr_stress_11" type="checkbox" />
        <input name="attr_stress_12" type="checkbox" />
        <input name="attr_stress_13" type="checkbox" />
        <input name="attr_stress_14" type="checkbox" />
        <input name="attr_stress_15" type="checkbox" />
        <input name="attr_stress_16" type="checkbox" />
        <input name="attr_stress_17" type="checkbox" />
        <input name="attr_stress_18" type="checkbox" />
        <input name="attr_stress_19" type="checkbox" />
        <input name="attr_stress_20" type="checkbox" />
      </div>
    </div>
    <div>
      <label>Languages:</label>
      <textarea name="attr_lnaguages"></textarea>
    </div>
  </section>

  <section class="soak f-col nowrap">
    <div style="display: inline-flex">
      <div>
        <label>Fortune</label>
        <input type="number" name="attr_fortune" value="3" />
      </div>
      <div>
        <label>Exp</label>
        <input type="number" name="attr_exp" value="0" />
      </div>
    </div>
    <div style="display: inline-flex">
      <div>
        <label>Courage</label>
        <input type="number" name="attr_courage" value="0" />
      </div>
      <div>
        <label>Armour</label>
        <input type="number" name="attr_armour" value="0" />
      </div>
    </div>
  </section>

  <section class="injuries">
    <label>Injuries:</label>
    <div class="f-row nowrap">
      <textarea name="attr_injury_1"></textarea>
      <textarea name="attr_injury_2"></textarea>
      <textarea name="attr_injury_3"></textarea>
    </div>
  </section>

  <section class="attr f-row nowrap">
    <div class="f-col">
      <h3>Attributes</h3>
      <label>Rating</label>
      <label>Bonus Damage</label>
    </div>
    <div class="f-col">
      <span class="attribute_header">
        <label>Agility</label>
        <button type="roll" name="roll_agility"
          value="@{whisper}&{template:skill} {{subtitle=Agility}} {{title=@{character_name}}} {{num_dice=[[?{Dice|2}]]}} {{target_skill=?{Relevant Skill|None,0|Acedemia,@{skill_academia}|Athletics,@{skill_athletics}|Engineering,@{skill_engineering}|Fighting,@{skill_fighting}|Medicine,@{skill_medicine}|Observation,@{skill_observation}|Persuasion,@{skill_persuasion}|Resilience,@{skill_resilience}|Stealth,@{skill_stealth}|Survival,@{skill_survival}|Tactics,@{skill_tactics}|Vehicles,@{skill_vehicles}}}} {{focus_roll=?{Does A Focus Apply|No,1|Yes,?{Relevant Skill&amp;#125;}}}  {{target_attribute=@{agility}}}  {{target_number=[[@{agility}+?{Relevant Skill}]] }} {{successes1=[[?{Dice}d20cs<?{Does A Focus Apply}cf20<[[@{agility}+?{Relevant Skill}]]]]}} "></button>
      </span>
      <input type="number" name="attr_agility" value="6" />
      <input type="number" name="attr_agility_bonus_dmg" value="0" />
    </div>
    <div class="f-col">
      <span class="attribute_header">
        <label>Brawn</label>
        <button type="roll" name="roll_brawn"
          value="@{whisper}&{template:skill} {{subtitle=Brawn}} {{title=@{character_name}}} {{num_dice=[[?{Dice|2}]]}} {{target_skill=?{Relevant Skill|None,0|Acedemia,@{skill_academia}|Athletics,@{skill_athletics}|Engineering,@{skill_engineering}|Fighting,@{skill_fighting}|Medicine,@{skill_medicine}|Observation,@{skill_observation}|Persuasion,@{skill_persuasion}|Resilience,@{skill_resilience}|Stealth,@{skill_stealth}|Survival,@{skill_survival}|Tactics,@{skill_tactics}|Vehicles,@{skill_vehicles}}}} {{focus_roll=?{Does A Focus Apply|No,1|Yes,?{Relevant Skill&amp;#125;}}}  {{target_attribute=@{brawn}}}  {{target_number=[[@{brawn}+?{Relevant Skill}]] }} {{successes1=[[?{Dice}d20cs<?{Does A Focus Apply}cf20<[[@{brawn}+?{Relevant Skill}]]]]}} "></button>
      </span>
      <input type="number" name="attr_brawn" value="6" />
      <input type="number" name="attr_brawn_bonus_dmg" value="0" />
    </div>
    <div class="f-col">
      <span class="attribute_header">
        <label>Coordination</label>
        <button type="roll" name="roll_coordination"
          value="@{whisper}&{template:skill} {{subtitle=Coordination}} {{title=@{character_name}}} {{num_dice=[[?{Dice|2}]]}} {{target_skill=?{Relevant Skill|None,0|Acedemia,@{skill_academia}|Athletics,@{skill_athletics}|Engineering,@{skill_engineering}|Fighting,@{skill_fighting}|Medicine,@{skill_medicine}|Observation,@{skill_observation}|Persuasion,@{skill_persuasion}|Resilience,@{skill_resilience}|Stealth,@{skill_stealth}|Survival,@{skill_survival}|Tactics,@{skill_tactics}|Vehicles,@{skill_vehicles}}}} {{focus_roll=?{Does A Focus Apply|No,1|Yes,?{Relevant Skill&amp;#125;}}}  {{target_attribute=@{coordination}}}  {{target_number=[[@{coordination}+?{Relevant Skill}]] }} {{successes1=[[?{Dice}d20cs<?{Does A Focus Apply}cf20<[[@{coordination}+?{Relevant Skill}]]]]}} "></button>
      </span>
      <input type="number" name="attr_coordination" value="6" />
      <input type="number" name="attr_coordination_bonus_dmg" value="0" />
    </div>
    <div class="f-col">
      <span class="attribute_header">
        <label>Insight</label>
        <button type="roll" name="roll_insight"
          value="@{whisper}&{template:skill} {{subtitle=Insight}} {{title=@{character_name}}} {{num_dice=[[?{Dice|2}]]}} {{target_skill=?{Relevant Skill|None,0|Acedemia,@{skill_academia}|Athletics,@{skill_athletics}|Engineering,@{skill_engineering}|Fighting,@{skill_fighting}|Medicine,@{skill_medicine}|Observation,@{skill_observation}|Persuasion,@{skill_persuasion}|Resilience,@{skill_resilience}|Stealth,@{skill_stealth}|Survival,@{skill_survival}|Tactics,@{skill_tactics}|Vehicles,@{skill_vehicles}}}} {{focus_roll=?{Does A Focus Apply|No,1|Yes,?{Relevant Skill&amp;#125;}}}  {{target_attribute=@{insight}}}  {{target_number=[[@{insight}+?{Relevant Skill}]] }} {{successes1=[[?{Dice}d20cs<?{Does A Focus Apply}cf20<[[@{insight}+?{Relevant Skill}]]]]}} "></button>
      </span>
      <input type="number" name="attr_insight" value="6" />
      <input type="number" name="attr_insight_bonus_dmg" value="0" />
    </div>
    <div class="f-col">
      <span class="attribute_header">
        <label>Reason</label>
        <button type="roll" name="roll_reason"
          value="@{whisper}&{template:skill} {{subtitle=Reason}} {{title=@{character_name}}} {{num_dice=[[?{Dice|2}]]}} {{target_skill=?{Relevant Skill|None,0|Acedemia,@{skill_academia}|Athletics,@{skill_athletics}|Engineering,@{skill_engineering}|Fighting,@{skill_fighting}|Medicine,@{skill_medicine}|Observation,@{skill_observation}|Persuasion,@{skill_persuasion}|Resilience,@{skill_resilience}|Stealth,@{skill_stealth}|Survival,@{skill_survival}|Tactics,@{skill_tactics}|Vehicles,@{skill_vehicles}}}} {{focus_roll=?{Does A Focus Apply|No,1|Yes,?{Relevant Skill&amp;#125;}}}  {{target_attribute=@{reason}}}  {{target_number=[[@{reason}+?{Relevant Skill}]] }} {{successes1=[[?{Dice}d20cs<?{Does A Focus Apply}cf20<[[@{reason}+?{Relevant Skill}]]]]}} "></button>
      </span>
      <input type="number" name="attr_reason" value="6" />
      <input type="number" name="attr_reason_bonus_dmg" value="0" />
    </div>
    <div class="f-col">
      <span class="attribute_header">
        <label>Will</label>
        <button type="roll" name="roll_will"
          value="@{whisper}&{template:skill} {{subtitle=Will}} {{title=@{character_name}}} {{num_dice=[[?{Dice|2}]]}} {{target_skill=?{Relevant Skill|None,0|Acedemia,@{skill_academia}|Athletics,@{skill_athletics}|Engineering,@{skill_engineering}|Fighting,@{skill_fighting}|Medicine,@{skill_medicine}|Observation,@{skill_observation}|Persuasion,@{skill_persuasion}|Resilience,@{skill_resilience}|Stealth,@{skill_stealth}|Survival,@{skill_survival}|Tactics,@{skill_tactics}|Vehicles,@{skill_vehicles}}}} {{focus_roll=?{Does A Focus Apply|No,1|Yes,?{Relevant Skill&amp;#125;}}}  {{target_attribute=@{will}}}  {{target_number=[[@{will}+?{Relevant Skill}]] }} {{successes1=[[?{Dice}d20cs<?{Does A Focus Apply}cf20<[[@{will}+?{Relevant Skill}]]]]}} "></button>
      </span>
      <input type="number" name="attr_will" value="6" />
      <input type="number" name="attr_will_bonus_dmg" value="0" />
    </div>
  </section>

  <section class="skills f-col">
    <div class="f-row">
      <h3 class="f2">Skills</h3>
      <label class="f1">Ranks</label>
      <label class="f8">Focuses</label>
    </div>
    <div class="f-row">
      <label class="f2">Academia</label>
      <input class="f1" type="number" name="attr_skill_academia" value="0" />
      <div class="f8 f-row wrap skill_row">
        <div><input name="attr_foc_art" type="checkbox" /><span>Art</span></div>
        <div>
          <input name="attr_foc_cryptography" type="checkbox" /><span>Cryptography</span>
        </div>
        <div>
          <input name="attr_foc_finance" type="checkbox" /><span>Finance</span>
        </div>
        <div>
          <input name="attr_foc_history" type="checkbox" /><span>History</span>
        </div>
        <div>
          <input name="attr_foc_linguistics" type="checkbox" /><span>Linguistics</span>
        </div>
        <div>
          <input name="attr_foc_occultism" type="checkbox" /><span>Occultism</span>
        </div>
        <div>
          <input name="attr_foc_science" type="checkbox" /><span>Science</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2">Athletics</label>
      <input class="f1" type="number" name="attr_skill_athletics" value="0" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_climbing" type="checkbox" /><span>Climbing</span>
        </div>
        <div>
          <input name="attr_foc_lifting" type="checkbox" /><span>Lifting</span>
        </div>
        <div>
          <input name="attr_foc_phsyical_training" type="checkbox" /><span>Phsyical Training</span>
        </div>
        <div>
          <input name="attr_foc_running" type="checkbox" /><span>Running</span>
        </div>
        <div>
          <input name="attr_foc_swimming" type="checkbox" /><span>Swimming</span>
        </div>
        <div>
          <input name="attr_foc_throwing" type="checkbox" /><span>Throwing</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2">Engineering</label>
      <input class="f1" type="number" name="attr_skill_engineering" value="0" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_architecture" type="checkbox" /><span>Architecture</span>
        </div>
        <div>
          <input name="attr_foc_combat_engineering" type="checkbox" /><span>Combat Engineering</span>
        </div>
        <div>
          <input name="attr_foc_electronics" type="checkbox" /><span>Electronics</span>
        </div>
        <div>
          <input name="attr_foc_explosives" type="checkbox" /><span>Explosives</span>
        </div>
        <div>
          <input name="attr_foc_mechanical_engineering" type="checkbox" /><span>Mechanical Engineering</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2">Fighting</label>
      <input class="f1" type="number" name="attr_skill_fighting" value="0" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_close_quarters" type="checkbox" /><span>Close Quarters</span>
        </div>
        <div>
          <input name="attr_foc_handguns" type="checkbox" /><span>Handguns</span>
        </div>
        <div>
          <input name="attr_foc_hand_to_hand" type="checkbox" /><span>Hand-to-Hand</span>
        </div>
        <div>
          <input name="attr_foc_heavy_weapons" type="checkbox" /><span>Heavy Weapons</span>
        </div>
        <div>
          <input name="attr_foc_melee_weapons" type="checkbox" /><span>Melee Weapons</span>
        </div>
        <div>
          <input name="attr_foc_rifles" type="checkbox" /><span>Rifles</span>
        </div>
        <div>
          <input name="attr_foc_threat_awareness" type="checkbox" /><span>Threat Awareness</span>
        </div>
        <div>
          <input name="attr_foc_exotic" type="checkbox" /><span>Exotic</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2">Medicine</label>
      <input class="f1" type="number" name="attr_skill_medicine" value="0" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_close_first_aid" type="checkbox" /><span>First Aid</span>
        </div>
        <div>
          <input name="attr_foc_infectious_diseases" type="checkbox" /><span>Infectious Diseases</span>
        </div>
        <div>
          <input name="attr_foc_pharmacology" type="checkbox" /><span>Pharmacology</span>
        </div>
        <div>
          <input name="attr_foc_psychiarty" type="checkbox" /><span>Psychiarty</span>
        </div>
        <div>
          <input name="attr_foc_surgey" type="checkbox" /><span>Surgey</span>
        </div>
        <div>
          <input name="attr_foc_toxicology" type="checkbox" /><span>Toxicology</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2">Observation</label>
      <input class="f1" type="number" name="attr_skill_observation" value="0" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_hearing" type="checkbox" /><span>Hearing</span>
        </div>
        <div>
          <input name="attr_foc_instincts" type="checkbox" /><span>Instincts</span>
        </div>
        <div>
          <input name="attr_foc_sight" type="checkbox" /><span>Sight</span>
        </div>
        <div>
          <input name="attr_foc_smell_and_taste" type="checkbox" /><span>Smell and Taste</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2">Persuasion</label>
      <input class="f1" type="number" name="attr_skill_persuasion" value="0" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_charm" type="checkbox" /><span>Charm</span>
        </div>
        <div>
          <input name="attr_foc_inneuendo" type="checkbox" /><span>Inneuendo</span>
        </div>
        <div>
          <input name="attr_foc_intimidation" type="checkbox" /><span>Intimidation</span>
        </div>
        <div>
          <input name="attr_foc_negotiation" type="checkbox" /><span>Negotiation</span>
        </div>
        <div>
          <input name="attr_foc_rhetoric" type="checkbox" /><span>Rhetoric</span>
        </div>
        <div>
          <input name="attr_foc_deceive" type="checkbox" /><span>Deceive</span>
        </div>
        <div>
          <input name="attr_foc_invocation" type="checkbox" /><span>Invocation</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2">Resilience</label>
      <input class="f1" type="number" name="attr_skill_resilience" value="0" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_fortitude" type="checkbox" /><span>Fortitude</span>
        </div>
        <div>
          <input name="attr_foc_discipline" type="checkbox" /><span>Discipline</span>
        </div>
        <div>
          <input name="attr_foc_immunity" type="checkbox" /><span>Immunity</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2">Stealth</label>
      <input class="f1" type="number" name="attr_skill_stealth" value="0" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_camouflage" type="checkbox" /><span>Camouflage</span>
        </div>
        <div>
          <input name="attr_foc_disguise" type="checkbox" /><span>Disguise</span>
        </div>
        <div>
          <input name="attr_foc_rural_stealth" type="checkbox" /><span>Rural Stealth</span>
        </div>
        <div>
          <input name="attr_foc_urban_stealth" type="checkbox" /><span>Urban Stealth</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2">Survival</label>
      <input class="f1" type="number" name="attr_skill_survival" value="0" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_animal_handling" type="checkbox" /><span>Animal Handling</span>
        </div>
        <div>
          <input name="attr_foc_foraging" type="checkbox" /><span>Foraging</span>
        </div>
        <div>
          <input name="attr_foc_hunting" type="checkbox" /><span>Hunting</span>
        </div>
        <div>
          <input name="attr_foc_mysticism" type="checkbox" /><span>Mysticism</span>
        </div>
        <div>
          <input name="attr_foc_orienteering" type="checkbox" /><span>Orienteering</span>
        </div>
        <div>
          <input name="attr_foc_tracking" type="checkbox" /><span>Tracking</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2">Tactics</label>
      <input class="f1" type="number" name="attr_skill_tactics" value="0" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_air_force" type="checkbox" /><span>Air Force</span>
        </div>
        <div>
          <input name="attr_foc_army" type="checkbox" /><span>Army</span>
        </div>
        <div>
          <input name="attr_foc_covert_operations" type="checkbox" /><span>Covert Operations</span>
        </div>
        <div>
          <input name="attr_foc_leadership" type="checkbox" /><span>Leadership</span>
        </div>
        <div>
          <input name="attr_foc_navy" type="checkbox" /><span>Navy</span>
        </div>
        <div>
          <input name="attr_foc_technical_projects" type="checkbox" /><span>Technical Projects</span>
        </div>
      </div>
    </div>
    <div class="f-row">
      <label class="f2">Vehicles</label>
      <input class="f1" type="number" name="attr_skill_vehicles" value="0" />
      <div class="f8 f-row wrap skill_row">
        <div>
          <input name="attr_foc_cars" type="checkbox" /><span>Cars</span>
        </div>
        <div>
          <input name="attr_foc_motorcycles" type="checkbox" /><span>Motorcycles</span>
        </div>
        <div>
          <input name="attr_foc_heavy_vehicles" type="checkbox" /><span>Heavy Vehicles</span>
        </div>
        <div>
          <input name="attr_foc_tanks" type="checkbox" /><span>Tanks</span>
        </div>
        <div>
          <input name="attr_foc_aircraft" type="checkbox" /><span>Aircraft</span>
        </div>
        <div>
          <input name="attr_foc_technical_watercraft" type="checkbox" /><span>Watercraft</span>
        </div>
      </div>
    </div>
  </section>
</div>

<div class="sheet-equipment">
  <section class="e_header f-row f-center">
    <h1>Achtung! Cthulhu</h1>
    <span>Character Record Sheet</span>
    <span>2d20</span>
  </section>

  <section class="equip f-col">
    <div class="f-row">
      <h3>Equipment of Note</h3>
    </div>
    <hr>
    <div class="f-row">
      <textarea class="f1" name="attr_equip_desc_1"></textarea>
      <textarea class="f1" name="attr_equip_desc_2"></textarea>
      <textarea class="f1" name="attr_equip_desc_3"></textarea>
      <textarea class="f1" name="attr_equip_desc_4"></textarea>
    </div>
    <div class="f-row">
      <textarea class="f1" name="attr_equip_desc_5"></textarea>
      <textarea class="f1" name="attr_equip_desc_6"></textarea>
      <textarea class="f1" name="attr_equip_desc_7"></textarea>
      <textarea class="f1" name="attr_equip_desc_8"></textarea>
    </div>
    <div class="f-row">
      <textarea class="f1" name="attr_equip_desc_9"></textarea>
      <textarea class="f1" name="attr_equip_desc_10"></textarea>
      <textarea class="f1" name="attr_equip_desc_11"></textarea>
      <textarea class="f1" name="attr_equip_desc_12"></textarea>
    </div>
  </section>

  <section class="weapons f-col">
    <div class="f-row">
      <h3>Weapons</h3>
    </div>
    <hr>

    <fieldset class="repeating_weapons">
      <div class="f-row weapons_row1">
        <div class="f1 weapoons-chat">
          <span style="display: block">&nbsp;</span>
          <button type="roll" name="roll_weapon" class="chat_button"
            value="@{whisper}&{template:weapon} {{title=@{character_name}}} {{name=@{weapons_name}}} {{type=@{weapons_type}}} {{focus=@{weapons_focus}}} {{range=@{weapons_range}}} {{damage=@{weapons_damage}}} {{ammo=@{weapons_ammo}}} {{salvo=@{weapons_salvo}}} {{size=@{weapons_size}}} {{qualities=@{weapons_qualities}}}"></button>
          </div>
        <div class="f8">
          <label>Name:</label>
          <input name="attr_weapons_name" type="text" style="width: 250px" />
        </div>
        <div class="f6">
          <label>Type:</label>
          <select name="attr_weapons_type">
            <option value="None" selected></option>
            <option value="Melee">Melee</option>
            <option value="Ranged">Ranged</option>
            <option value="Mental">Mental</option>
          </select>
        </div>
        <div class="f6">
          <label>Focus:</label>
          <select name="attr_weapons_focus">
            <option value="None" selected></option>
            <option value="Hand to Hand">Hand to Hand</option>
            <option value="Close Quarters">Close Quarters</option>
            <option value="Melee Weapons">Melee Weapons</option>
            <option value="Handguns">Handguns</option>
            <option value="Rifles">Rifles</option>
            <option value="Heavy Weapons">Heavy Weapons</option>
            <option value="Exotic">Exotic</option>
            <option value="Throwing">Throwing</option>
          </select>
        </div>
      </div>
      <div class="f-row weapons_row2">
        <div class="f1">
          <label>Range</label>
          <textarea name="attr_weapons_range"></textarea>
        </div>
        <div class="f1">
          <label>Damage</label>
          <textarea name="attr_weapons_damage"></textarea>
        </div>
        <div class="f1">
          <label>Ammo</label>
          <textarea name="attr_weapons_ammo"></textarea>
        </div>
        <div class="f1">
          <label>Salvo</label>
          <textarea name="attr_weapons_salvo"></textarea>
        </div>
        <div class="f1">
          <label>Size</label>
          <textarea name="attr_weapons_size"></textarea>
        </div>
        <div class="f1">
          <label>Qualities</label>
          <textarea name="attr_weapons_qualities"></textarea>
        </div>
      </div>
      <hr>
    </fieldset>
  </section>

  <section class="talents f-col">
    <div class="f-row">
      <h3>Talents</h3>
    </div>
    <hr>

    <div class="f-row">
      <span class="f1">&nbsp;</span>
      <label class="f3">Name</label>
      <label class="f3">Keywords</label>
      <label class="f12">Effect</label>
    </div>

    <fieldset class="repeating_talents">
      <div class="f-row talent_row">
        <div class="f1 talents-chat">
          <button type="roll" name="roll_talent" class="chat_button"
            value="@{whisper}&{template:talent} {{title=@{character_name}}} {{name=@{talents_name}}} {{keywords=@{talents_keywords}}} {{effect=@{talents_effect}}}"></button>
        </div>
        <textarea class="f3" name="attr_talents_name"></textarea>
        <textarea class="f3" name="attr_talents_keywords"></textarea>
        <textarea class="f12" name="attr_talents_effect"></textarea>
      </div>
    </fieldset>
  </section>
</div>

<div class="sheet-spells">
  <section class="s_header f-row f-center">
    <h1>Achtung! Cthulhu</h1>
    <span>Character Record Sheet</span>
    <span>2d20</span>
  </section>

  <section class="magic f-col">
    <div class="f-row">
      <div class="f3">
        <label>Spellcaster Type</label>
        <select name="attr_spell_skill">
          <option value="None" selected></option>
          <option value="Traditional">Traditional</option>
          <option value="Researcher">Researcher</option>
          <option value="Dabbler">Dabbler</option>
        </select>
      </div>
      <span id="NoTradition" name="NoTradition" class="f4">&nbsp;</span>
      <div id="YesTradition" name="YesTradition" class="f4 hide_element">
        <label>Tradition</label>
        <input name="attr_spell_tradition" type="text" style="width: 150px" />
      </div>
      <div class="f2">
        <label>Power</label>
        <input type="number" name="attr_spells_power" value="0" />
      </div>
    </div>
  </section>

  <section class="spells f-col">
    <div class="f-row">
      <h3>Spells</h3>
    </div>
    <hr>

    <fieldset class="repeating_spells">
      <div class="f-row spell_row1">
        <div class="f1 spells-chat">
          <span style="display: block">&nbsp;</span>
          <button type="roll" name="roll_spell" class="chat_button"
            value="@{whisper}&{template:spell} {{title=@{character_name}}} {{name=@{spell_name}}} {{skill=@{spell_skill}}} {{difficulty=@{spell_difficulty}}} {{cost=@{spell_cost}}} {{duration=@{spell_duration}}} {{effect=@{spell_effect}}} {{momentum=@{spell_momentum}}}"></button>
        </div>
        <div class="f8">
          <label>Name:</label>
          <input name="attr_spell_name" type="text" style="width: 200px" />
        </div>
        <div class="f4">
          <label>Skill:</label>
          <select name="attr_spell_skill">
            <option value="None" selected></option>
            <option value="Academia">Academia</option>
            <option value="Athletics">Athletics</option>
            <option value="Engineering">Engineering</option>
            <option value="Fighting">Fighting</option>
            <option value="Medicine">Medicine</option>
            <option value="Observation">Observation</option>
            <option value="Persuasion">Persuasion</option>
            <option value="Resilience">Resilience</option>
            <option value="Stealth">Stealth</option>
            <option value="Survival">Survival</option>
            <option value="Tactics">Tactics</option>
            <option value="Vehicles">Vehicles</option>
          </select>
        </div>
        <div class="f4">
          <label>Difficulty</label>
          <input type="number" name="attr_spell_difficulty" value="0" />
        </div>
        <div class="f4">
          <label>Cost</label>
          <input name="attr_spell_cost" type="text" style="width: 100px" />
        </div>
        <div class="f4">
          <label>Duration</label>
          <input name="attr_spell_duration" type="text" style="width: 100px" />
        </div>
      </div>
      <div class="f-row spell_row2">
        <div class="f1">
          <label>Effect</label>
          <textarea name="attr_spell_effect"></textarea>
        </div>
        <div class="f1">
          <label>Momentum</label>
          <textarea name="attr_spell_momentum"></textarea>
        </div>
      </div>
      <hr>
    </fieldset>
  </section>
</div>

<div class="sheet-settings">
  <section class="st_header f-row f-center">
    <h1>Achtung! Cthulhu</h1>
    <span>Character Record Sheet</span>
    <span>2d20</span>
  </section>

  <section class="settings_left f-col">
    <div>
      <label>Whisper roles to GM:</label>
      <select name="attr_whisper">
        <option value="" selected>Never</option>
        <option value="/w gm ">Always</option>
      </select>
    </div>
  </section>

  <section class="settings_right f-col">
  </section>
</div>

<!-- roll templates -->

<rolltemplate class="sheet-rolltemplate-rolls">
  <div class="sheet-container">
    <div class="sheet-header">
      {{#title}}
      <div class="sheet-title">{{title}}</div>
      {{/title}}
      {{#name}}
      <div class="sheet-name">{{name}}</div>
      {{/name}}
      {{#subtitle}}
      <div class="sheet-subtitle">{{subtitle}}</div>
      {{/subtitle}}
    </div>
    <div class="sheet-content">
      {{#allprops() title name subtitle desc}}
      <div class="sheet-key">{{key}}</div>
      <div class="sheet-value">{{value}}</div>
      {{/allprops() title name subtitle desc}}
      {{#desc}}
      <div class="sheet-desc">{{desc}}</div>
      {{/desc}}
    </div>
  </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-skill">
  <div class="sheet-container">
    <div class="sheet-header">
      {{#title}}
      <div class="sheet-title">{{title}}</div>
      {{/title}}
      {{#name}}
      <div class="sheet-name">{{name}}</div>
      {{/name}}
      {{#subtitle}}
      <div class="sheet-subtitle">{{subtitle}}</div>
      {{/subtitle}}
    </div>
    <div class="sheet-content">
      <span>Attribute value is:</span>
      <span style="font-size: 1.2em; color: red">{{target_attribute}}</span>
      <span>Skill value is:</span>
      <span style="font-size: 1.2em; color: red">{{target_skill}}</span>
      <span>Target number is:</span>
      <span class="sheet-target-number" style="font-size: 1.2em; color: red">{{target_number}}</span>
      <p style="margin-bottom: 8px">
        <span>Scores</span> {{successes1}} <span>successes!</span>
      </p>
    </div>
  </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-talent">
  <div class="sheet-container">
    <div class="sheet-header">
      {{#title}}
      <div class="sheet-title">{{title}}</div>
      {{/title}}
      {{#name}}
      <div class="sheet-name">{{name}}</div>
      {{/name}}
      {{#keywords}}
      <div class="sheet-keywords">{{keywords}}</div>
      {{/keywords}}
    </div>
    <div class="sheet-content">
      <div>{{effect}}</div>
    </div>
  </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-spell">
  <div class="sheet-container">
    <div class="sheet-header">
      {{#title}}
      <div class="sheet-title">{{title}}</div>
      {{/title}}
      {{#name}}
      <div class="sheet-name">{{name}}</div>
      {{/name}}
    </div>
    <div class="sheet-content">
      {{#skill}}
      <span>Skill:</span>
      <span>{{skill}}</span>
      {{/skill}}
      {{#difficulty}}
      <span>Difficulty:</span>
      <span>{{difficulty}}</span>
      {{/difficulty}}
      {{#cost}}
      <span>Cost:</span>
      <span>{{cost}}</span>
      {{/cost}}
      {{#duration}}
      <span>Duration:</span>
      <span>{{duration}}</span>
      {{/duration}}
    </div>
    <div class="sheet-content2">
      {{#effect}}
      <span>Effect:</span>
      <span>{{effect}}</span>
      {{/effect}}
      {{#momentum}}
      <span>Momentum:</span>
      <span>{{momentum}}</span>
      {{/momentum}}
    </div>
  </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-weapon">
  <div class="sheet-container">
    <div class="sheet-header">
      {{#title}}
      <div class="sheet-title">{{title}}</div>
      {{/title}}
      {{#name}}
      <div class="sheet-name">{{name}}</div>
      {{/name}}
      {{#type}}
      <div class="sheet-name">{{type}}</div>
      {{/type}}
      {{#focus}}
      <div class="sheet-name">{{focus}}</div>
      {{/focus}}
    </div>
    <div class="sheet-content">
      {{#range}}
      <span>Range:</span>
      <span>{{range}}</span>
      {{/range}}
      {{#damage}}
      <span>Damage:</span>
      <span>{{damage}}</span>
      {{/damage}}
      {{#ammo}}
      <span>Ammo:</span>
      <span>{{ammo}}</span>
      {{/ammo}}
      {{#salvo}}
      <span>Salvo:</span>
      <span>{{salvo}}</span>
      {{/salvo}}
      {{#size}}
      <span>Size:</span>
      <span>{{size}}</span>
      {{/size}}
      {{#qualities}}
      <span>Qualities:</span>
      <span>{{qualities}}</span>
      {{/qualities}}
    </div>
  </div>
</rolltemplate>

<!-- scripts -->

<script type="text/worker">

  const int = score => parseInt(score, 10) || 0;

  const stats = ["agility", "brawn", "coordination", "insight", "reason", "will"];
  stats.forEach(stat => {
    on(`change:${stat}`, () => {
      getAttrs([stat], values => {
            const stat_base = int(values[stat]);
              let stat_mod = 0;
              if (stat_base >= 16) stat_mod = 5;
              else if (stat_base >= 14) stat_mod = 4;
              else if (stat_base >= 12) stat_mod = 3;
              else if (stat_base >= 10) stat_mod = 2;
              else if (stat_base >= 9) stat_mod = 1;
              
              setAttrs({
                  [`${stat}_bonus_dmg`]: stat_mod
              });
          });
      });
  });

  on("change:brawn change:will change:skill_resilience", function() {  
    getAttrs(["brawn","will","skill_resilience"], function(values) {
      let brawn = parseInt(values.brawn)||0;
      let will = parseInt(values.will)||0;
      let resilience = parseInt(values.skill_resilience)||0;
      let stress_brawn = brawn + resilience;
      let stress_will = will + resilience;
      let stress_total = stress_brawn >= stress_will ? stress_brawn: stress_will;
      setAttrs({                            
        "stress_max": stress_total
      });
    });
  });

  const hideShowSpellTradition = () => {
    getAttrs(["spell_skill"], function(values) {
      let skill = parseInt(values.spell_skill)||"";

      $20("#NoTradition").removeClass("show_element").addClass("hide_element");
      $20("#YesTradition").removeClass("show_element").addClass("hide_element");;

      if (values.spell_skill == "Traditional")
        $20("#YesTradition").removeClass("hide_element").addClass("show_element");
      else
        $20("#NoTradition").removeClass("hide_element").addClass("show_element");
  
      });
  };

  on("change:spell_skill", function() {  
    hideShowSpellTradition();
  });

  const buttonlist = ["main_char","equipment","spells","settings"];
  buttonlist.forEach(button => {
      on(`clicked:${button}`, function() {
      $20(".tab_button_selected").removeClass('tab_button_selected');
      $20("#act_" + button).addClass('tab_button_selected');
      setAttrs({
        sheetTab: button
      });
    });
  });

  on('sheet:opened',function(){
  	$20("#act_main_char").addClass('tab_button_selected');
  	setAttrs({
  		sheetTab: "main_char"
  	});
    hideShowSpellTradition();
  });


</script>